# This file is part of the Fuzion language implementation.
#
# The Fuzion language implementation is free software: you can redistribute it
# and/or modify it under the terms of the GNU General Public License as published
# by the Free Software Foundation, version 3 of the License.
#
# The Fuzion language implementation is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
# License for more details.
#
# You should have received a copy of the GNU General Public License along with The
# Fuzion language implementation.  If not, see <https://www.gnu.org/licenses/>.


# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of Fuzion test inherit_postcondition/modules/mod.fz
#
#  Author: Fridtjof Siebert (siebert@tokiwa.software)
#
# -----------------------------------------------------------------------

# this provides features with complex postconditions to check
# that inheritance of post conditions from a module works
#
public mod is

  ok(s String) => say s; true

  public post_accessing_result is
    public n := 333
    public r => 666
    public f
      post
        n * 2 = r
        ok "original $result $n $r"
        { io.out.env.println "hi"; true }
#       { v := post_accessing_result.this; true }    # NYI:  does not work yet!
#       { [1,result,2].fold i32.sum > 3 }            # NYI:  does not work yet!
        result > 23
    =>
      42

  public post_accessing_result_child : post_accessing_result is
    public redef f
      post then
        ok "redef $result"
        { io.out.env.println "hi"; true }
        result % 5 = 1
    =>
      4711

  public post_accessing_result_child2 : post_accessing_result_child is
    public redef f
      post then
        ok "redef2 $result"
        { io.out.env.println "hi"; true }
        true
    =>
      4716
